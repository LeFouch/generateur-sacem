<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G√©n√©rateur SACEM</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 800px; margin: 0 auto; background: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); overflow: hidden; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; }
        .header p { opacity: 0.9; font-size: 1.1em; }
        .content { padding: 30px; }
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: bold; color: #333; }
        input, select, textarea { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; transition: border-color 0.3s; }
        input:focus, select:focus, textarea:focus { outline: none; border-color: #667eea; }
        .row { display: flex; gap: 15px; }
        .col { flex: 1; }
        .search-box { position: relative; }
        .suggestions { position: absolute; top: 100%; left: 0; right: 0; background: white; border: 2px solid #ddd; border-top: none; border-radius: 0 0 8px 8px; max-height: 200px; overflow-y: auto; z-index: 100; }
        .suggestion { padding: 12px; cursor: pointer; border-bottom: 1px solid #eee; }
        .suggestion:hover { background: #f5f5f5; }
        .suggestion:last-child { border-bottom: none; }
        .rightholders { margin: 20px 0; }
        .rightholder { background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 8px; border-left: 4px solid #667eea; }
        .rightholder-header { display: flex; justify-content: between; align-items: center; margin-bottom: 10px; }
        .rightholder-name { font-weight: bold; flex: 1; }
        .delete-btn { background: #e74c3c; color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; }
        .delete-btn:hover { background: #c0392b; }
        .percentage-input { width: 80px; margin-right: 10px; }
        .total { background: #e8f4fd; padding: 15px; border-radius: 8px; margin: 20px 0; text-align: center; font-weight: bold; }
        .total.error { background: #ffe6e6; color: #c0392b; }
        .total.success { background: #e6ffe6; color: #27ae60; }
        .generate-btn { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 15px 30px; font-size: 18px; border-radius: 8px; cursor: pointer; display: block; margin: 30px auto; transition: transform 0.2s; }
        .generate-btn:hover { transform: translateY(-2px); }
        .preview { background: #f8f9fa; padding: 20px; border-radius: 8px; margin-top: 20px; }
        .preview h3 { margin-bottom: 15px; color: #333; }
        .preview-content { white-space: pre-line; font-family: monospace; font-size: 14px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéµ G√©n√©rateur SACEM</h1>
            <p>Cr√©ez vos bulletins de d√©claration automatiquement</p>
        </div>
        
        <div class="content">
            <!-- Formulaire principal -->
            <div class="form-group">
                <label for="title">Titre de l'≈ìuvre *</label>
                <input type="text" id="title" placeholder="Nom de votre chanson">
            </div>
            
            <div class="form-group">
                <label for="subtitle">Sous-titre</label>
                <input type="text" id="subtitle" placeholder="Featuring ou sous-titre">
            </div>
            
            <div class="row">
                <div class="col">
                    <div class="form-group">
                        <label for="minutes">Dur√©e (minutes)</label>
                        <input type="number" id="minutes" min="0" value="3">
                    </div>
                </div>
                <div class="col">
                    <div class="form-group">
                        <label for="seconds">Secondes</label>
                        <input type="number" id="seconds" min="0" max="59" value="30">
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label for="genre">Genre</label>
                <select id="genre">
                    <option value="CHANSON">Chanson</option>
                    <option value="RAP">Rap</option>
                    <option value="ROCK">Rock</option>
                    <option value="POP">Pop</option>
                    <option value="ELECTRO">√âlectro</option>
                    <option value="JAZZ">Jazz</option>
                    <option value="AUTRE">Autre</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="date">Date de premi√®re exploitation</label>
                <input type="date" id="date">
            </div>
            
            <!-- Recherche d'artistes -->
            <div class="form-group">
                <label>Rechercher un artiste ou √©diteur</label>
                <div class="search-box">
                    <input type="text" id="search" placeholder="Tapez les premi√®res lettres...">
                    <div id="suggestions" class="suggestions" style="display: none;"></div>
                </div>
            </div>
            
            <!-- Liste des ayants droit -->
            <div class="rightholders">
                <h3>Ayants droit</h3>
                <div id="rightholders-list"></div>
            </div>
            
            <!-- Total -->
            <div id="total" class="total">
                Total: <span id="total-percentage">0</span>%
            </div>
            
            <!-- Bouton g√©n√©ration -->
            <button class="generate-btn" onclick="generateBulletin()">
                üìÑ G√©n√©rer le bulletin SACEM
            </button>
            
            <!-- Aper√ßu -->
            <div id="preview" class="preview" style="display: none;">
                <h3>Aper√ßu du bulletin</h3>
                <div id="preview-content" class="preview-content"></div>
            </div>
        </div>
    </div>

    <script>
        // Base de donn√©es d'artistes
        const database = [
            { id: 1, name: "VESCHAMBRE Yannick", pseudonym: "YAYA ONTHETRACK", type: "auteur-compositeur" },
            { id: 2, name: "ALL DAY EDITION", type: "editeur" },
            { id: 3, name: "432 CARATS PUBLISHING", type: "editeur" },
            { id: 4, name: "MARTIN Pierre", pseudonym: "PIERRE BEAT", type: "auteur-compositeur" },
            { id: 5, name: "SOUND FACTORY", type: "editeur" },
            { id: 6, name: "DUPONT Marie", pseudonym: "MARIE MELODY", type: "auteur-compositeur" },
            { id: 7, name: "STUDIO RECORDS", type: "editeur" }
        ];
        
        let rightholders = [];
        
        // Recherche avec autocompl√©tion
        document.getElementById('search').addEventListener('input', function(e) {
            const term = e.target.value.toLowerCase();
            const suggestions = document.getElementById('suggestions');
            
            if (term.length < 2) {
                suggestions.style.display = 'none';
                return;
            }
            
            const filtered = database.filter(item => 
                item.name.toLowerCase().includes(term) || 
                (item.pseudonym && item.pseudonym.toLowerCase().includes(term))
            );
            
            if (filtered.length > 0) {
                suggestions.innerHTML = filtered.map(item => 
                    `<div class="suggestion" onclick="selectArtist(${item.id})">
                        <strong>${item.name}</strong>
                        ${item.pseudonym ? `<br><small>(${item.pseudonym})</small>` : ''}
                        <br><small>${item.type}</small>
                    </div>`
                ).join('');
                suggestions.style.display = 'block';
            } else {
                suggestions.style.display = 'none';
            }
        });
        
        // S√©lectionner un artiste
        function selectArtist(id) {
            const artist = database.find(a => a.id === id);
            if (artist && !rightholders.find(r => r.id === id)) {
                rightholders.push({
                    id: artist.id,
                    name: artist.name,
                    pseudonym: artist.pseudonym || '',
                    type: artist.type,
                    percentage: 0
                });
                updateRightholdersList();
                document.getElementById('search').value = '';
                document.getElementById('suggestions').style.display = 'none';
            }
        }
        
        // Mettre √† jour la liste
        function updateRightholdersList() {
            const list = document.getElementById('rightholders-list');
            list.innerHTML = rightholders.map(holder => 
                `<div class="rightholder">
                    <div class="rightholder-header">
                        <div class="rightholder-name">
                            ${holder.name} ${holder.pseudonym ? `(${holder.pseudonym})` : ''}
                            <br><small>${holder.type}</small>
                        </div>
                        <button class="delete-btn" onclick="removeRightholder(${holder.id})">‚ùå</button>
                    </div>
                    <div>
                        <input type="number" class="percentage-input" value="${holder.percentage}" 
                               onchange="updatePercentage(${holder.id}, this.value)" min="0" max="100" step="0.1">
                        <span>%</span>
                    </div>
                </div>`
            ).join('');
            updateTotal();
        }
        
        // Supprimer un ayant droit
        function removeRightholder(id) {
            rightholders = rightholders.filter(r => r.id !== id);
            updateRightholdersList();
        }
        
        // Mettre √† jour le pourcentage
        function updatePercentage(id, value) {
            const holder = rightholders.find(r => r.id === id);
            if (holder) {
                holder.percentage = parseFloat(value) || 0;
                updateTotal();
            }
        }
        
        // Calculer le total
        function updateTotal() {
            const total = rightholders.reduce((sum, holder) => sum + holder.percentage, 0);
            const totalElement = document.getElementById('total');
            const totalPercentage = document.getElementById('total-percentage');
            
            totalPercentage.textContent = total.toFixed(1);
            
            if (total === 100) {
                totalElement.className = 'total success';
            } else {
                totalElement.className = 'total error';
            }
            
            updatePreview();
        }
        
        // Aper√ßu
        function updatePreview() {
            const title = document.getElementById('title').value;
            if (!title) return;
            
            const subtitle = document.getElementById('subtitle').value;
            const minutes = document.getElementById('minutes').value;
            const seconds = document.getElementById('seconds').value;
            const genre = document.getElementById('genre').value;
            const date = document.getElementById('date').value;
            
            const preview = `BULLETIN DE D√âCLARATION SACEM
=============================

TITRE: ${title}
${subtitle ? `SOUS-TITRE: ${subtitle}` : ''}
DUR√âE: ${minutes}:${seconds.padStart(2, '0')}
GENRE: ${genre}
${date ? `DATE D'EXPLOITATION: ${date}` : ''}

AYANTS DROIT:
${rightholders.map(holder => 
    `- ${holder.name} ${holder.pseudonym ? `(${holder.pseudonym})` : ''}: ${holder.percentage}%`
).join('\n')}

TOTAL: ${rightholders.reduce((sum, holder) => sum + holder.percentage, 0)}%`;
            
            document.getElementById('preview-content').textContent = preview;
            document.getElementById('preview').style.display = 'block';
        }
        
        // G√©n√©rer le bulletin
        function generateBulletin() {
            const total = rightholders.reduce((sum, holder) => sum + holder.percentage, 0);
            const title = document.getElementById('title').value;
            
            if (!title) {
                alert('Veuillez saisir un titre !');
                return;
            }
            
            if (rightholders.length === 0) {
                alert('Veuillez ajouter au moins un ayant droit !');
                return;
            }
            
            if (total !== 100) {
                alert(`Le total est de ${total}%. Il doit √™tre √©gal √† 100%.`);
                return;
            }
            
            const content = document.getElementById('preview-content').textContent;
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `SACEM_${title.replace(/\s+/g, '_')}.txt`;
            a.click();
            URL.revokeObjectURL(url);
        }
        
        // √âv√©nements
        document.getElementById('title').addEventListener('input', updatePreview);
        document.getElementById('subtitle').addEventListener('input', updatePreview);
        document.getElementById('minutes').addEventListener('input', updatePreview);
        document.getElementById('seconds').addEventListener('input', updatePreview);
        document.getElementById('genre').addEventListener('change', updatePreview);
        document.getElementById('date').addEventListener('change', updatePreview);
        
        // Cacher les suggestions quand on clique ailleurs
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.search-box')) {
                document.getElementById('suggestions').style.display = 'none';
            }
        });
    </script>
</body>
</html>
