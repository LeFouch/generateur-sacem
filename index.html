<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Générateur de Bulletin SACEM</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Configuration Tailwind
        tailwind.config = {
            theme: {
                extend: {
                    animation: {
                        'spin': 'spin 1s linear infinite',
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Icônes simplifiées
        const Search = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
        );

        const Trash2 = () => (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
            </svg>
        );

        const Download = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
            </svg>
        );

        const Users = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197m13.5-9a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0z" />
            </svg>
        );

        const Music = () => (
            <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 19V6l12-3v13M9 19c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zm12-3c0 1.105-1.343 2-3 2s-3-.895-3-2 1.343-2 3-2 3 .895 3 2zM9 10l12-3" />
            </svg>
        );

        const FileText = () => (
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
            </svg>
        );

        const Clock = () => (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
        );

        const Calendar = () => (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
            </svg>
        );

        const Globe = () => (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9" />
            </svg>
        );

        const Hash = () => (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 20l4-16m2 16l4-16M6 9h14M4 15h14" />
            </svg>
        );

        const Upload = () => (
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
            </svg>
        );

        const SACEMDeclarationTool = () => {
            // Base de données d'artistes et éditeurs
            const [database, setDatabase] = useState([
                {
                    id: 1,
                    name: "VESCHAMBRE Yannick",
                    pseudonym: "YAYA ONTHETRACK",
                    type: "auteur-compositeur",
                    email: "yaya@example.com",
                    phone: "+33 1 23 45 67 89",
                    address: "123 rue de la Musique, 75001 Paris"
                },
                {
                    id: 2,
                    name: "ALL DAY EDITION",
                    type: "editeur",
                    email: "contact@alldayedition.com",
                    phone: "+33 1 98 76 54 32",
                    address: "456 avenue des Éditeurs, 75002 Paris"
                },
                {
                    id: 3,
                    name: "432 CARATS PUBLISHING",
                    type: "editeur",
                    email: "info@432carats.com",
                    phone: "+33 1 11 22 33 44",
                    address: "789 boulevard des Droits, 75003 Paris"
                },
                {
                    id: 4,
                    name: "MARTIN Pierre",
                    pseudonym: "PIERRE BEAT",
                    type: "auteur-compositeur",
                    email: "pierre@example.com",
                    phone: "+33 1 55 66 77 88",
                    address: "321 rue du Rythme, 75004 Paris"
                },
                {
                    id: 5,
                    name: "SOUND FACTORY",
                    type: "editeur",
                    email: "contact@soundfactory.com",
                    phone: "+33 1 44 55 66 77",
                    address: "654 place de la Création, 75005 Paris"
                }
            ]);

            const [formData, setFormData] = useState({
                title: '',
                subtitle: '',
                duration: { minutes: 0, seconds: 0 },
                genre: 'CHANSON',
                exploitationDate: '',
                exploitationLocation: '',
                territories: { monde: true, autres: false },
                iswcCode: '',
                rightHolders: []
            });

            const [searchTerm, setSearchTerm] = useState('');
            const [suggestions, setSuggestions] = useState([]);
            const [showSuggestions, setShowSuggestions] = useState(false);

            // Fonction de recherche avec autocomplétion
            const handleSearch = (term) => {
                setSearchTerm(term);
                
                if (term.length > 1) {
                    const filtered = database.filter(item => 
                        item.name.toLowerCase().includes(term.toLowerCase()) ||
                        (item.pseudonym && item.pseudonym.toLowerCase().includes(term.toLowerCase()))
                    );
                    setSuggestions(filtered);
                    setShowSuggestions(true);
                } else {
                    setSuggestions([]);
                    setShowSuggestions(false);
                }
            };

            // Sélectionner un élément de la liste
            const selectSuggestion = (item) => {
                const newRightHolder = {
                    id: Date.now(),
                    name: item.name,
                    pseudonym: item.pseudonym || '',
                    type: item.type,
                    percentage: 0,
                    role: item.type === 'auteur-compositeur' ? 'Auteur/Compositeur' : 'Éditeur',
                    contact: {
                        email: item.email,
                        phone: item.phone,
                        address: item.address
                    }
                };
                
                setFormData(prev => ({
                    ...prev,
                    rightHolders: [...prev.rightHolders, newRightHolder]
                }));
                
                setSearchTerm('');
                setShowSuggestions(false);
                setSuggestions([]);
            };

            // Supprimer un ayant droit
            const removeRightHolder = (id) => {
                setFormData(prev => ({
                    ...prev,
                    rightHolders: prev.rightHolders.filter(holder => holder.id !== id)
                }));
            };

            // Mettre à jour le pourcentage
            const updatePercentage = (id, percentage) => {
                setFormData(prev => ({
                    ...prev,
                    rightHolders: prev.rightHolders.map(holder => 
                        holder.id === id ? { ...holder, percentage: parseFloat(percentage) || 0 } : holder
                    )
                }));
            };

            // Calculer le total des pourcentages
            const getTotalPercentage = () => {
                return formData.rightHolders.reduce((total, holder) => total + (holder.percentage || 0), 0);
            };

            // Générer le bulletin
            const generatePDF = () => {
                const totalPercentage = getTotalPercentage();
                
                if (totalPercentage !== 100) {
                    alert(`Attention: Le total des pourcentages est de ${totalPercentage}%. Il doit être égal à 100%.`);
                    return;
                }

                if (!formData.title || formData.rightHolders.length === 0) {
                    alert('Veuillez remplir au minimum le titre et ajouter au moins un ayant droit.');
                    return;
                }

                const bulletinContent = `
BULLETIN DE DÉCLARATION SACEM
==============================

TITRE: ${formData.title}
SOUS-TITRE: ${formData.subtitle}
DURÉE: ${formData.duration.minutes}:${formData.duration.seconds.toString().padStart(2, '0')}
GENRE: ${formData.genre}
DATE D'EXPLOITATION: ${formData.exploitationDate}
LIEU D'EXPLOITATION: ${formData.exploitationLocation}
CODE ISWC: ${formData.iswcCode}

AYANTS DROIT:
${formData.rightHolders.map(holder => 
  `- ${holder.name} ${holder.pseudonym ? `(${holder.pseudonym})` : ''}: ${holder.percentage}% - ${holder.role}`
).join('\n')}

TOTAL: ${totalPercentage}%

Date de génération: ${new Date().toLocaleDateString('fr-FR')}
`;

                // Créer et télécharger le fichier
                const blob = new Blob([bulletinContent], { type: 'text/plain;charset=utf-8' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `SACEM_${formData.title.replace(/\s+/g, '_')}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            };

            return (
                <div className="max-w-6xl mx-auto p-6 bg-gradient-to-br from-purple-50 to-pink-50 min-h-screen">
                    <div className="bg-white rounded-2xl shadow-xl p-8">
                        <div className="flex items-center gap-4 mb-8">
                            <div className="w-12 h-12 bg-gradient-to-br from-purple-600 to-pink-600 rounded-xl flex items-center justify-center">
                                <Music />
                            </div>
                            <div>
                                <h1 className="text-3xl font-bold text-gray-800">Générateur de Bulletin SACEM</h1>
                                <p className="text-gray-600">Créez automatiquement vos déclarations d'œuvres musicales</p>
                            </div>
                        </div>

                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            {/* Informations sur l'œuvre */}
                            <div className="space-y-6">
                                <div className="bg-gradient-to-r from-purple-100 to-pink-100 p-6 rounded-xl">
                                    <h2 className="text-xl font-semibold text-gray-800 mb-4 flex items-center gap-2">
                                        <FileText />
                                        Informations sur l'œuvre
                                    </h2>
                                    
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Titre de l'œuvre *</label>
                                            <input
                                                type="text"
                                                value={formData.title}
                                                onChange={(e) => setFormData(prev => ({ ...prev, title: e.target.value }))}
                                                className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                placeholder="Titre de la chanson"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Sous-titre</label>
                                            <input
                                                type="text"
                                                value={formData.subtitle}
                                                onChange={(e) => setFormData(prev => ({ ...prev, subtitle: e.target.value }))}
                                                className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                placeholder="Sous-titre ou featuring"
                                            />
                                        </div>

                                        <div className="grid grid-cols-2 gap-4">
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2">
                                                    <Clock />
                                                    Durée (min)
                                                </label>
                                                <input
                                                    type="number"
                                                    value={formData.duration.minutes}
                                                    onChange={(e) => setFormData(prev => ({ 
                                                        ...prev, 
                                                        duration: { ...prev.duration, minutes: parseInt(e.target.value) || 0 }
                                                    }))}
                                                    className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                    min="0"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-2">Secondes</label>
                                                <input
                                                    type="number"
                                                    value={formData.duration.seconds}
                                                    onChange={(e) => setFormData(prev => ({ 
                                                        ...prev, 
                                                        duration: { ...prev.duration, seconds: parseInt(e.target.value) || 0 }
                                                    }))}
                                                    className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                    min="0"
                                                    max="59"
                                                />
                                            </div>
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">Genre</label>
                                            <select
                                                value={formData.genre}
                                                onChange={(e) => setFormData(prev => ({ ...prev, genre: e.target.value }))}
                                                className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                            >
                                                <option value="CHANSON">Chanson</option>
                                                <option value="RAP">Rap</option>
                                                <option value="ROCK">Rock</option>
                                                <option value="POP">Pop</option>
                                                <option value="ELECTRO">Électro</option>
                                                <option value="JAZZ">Jazz</option>
                                                <option value="CLASSIQUE">Classique</option>
                                                <option value="AUTRE">Autre</option>
                                            </select>
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2">
                                                <Calendar />
                                                Date de première exploitation
                                            </label>
                                            <input
                                                type="date"
                                                value={formData.exploitationDate}
                                                onChange={(e) => setFormData(prev => ({ ...prev, exploitationDate: e.target.value }))}
                                                className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2">
                                                <Globe />
                                                Lieu d'exploitation
                                            </label>
                                            <input
                                                type="text"
                                                value={formData.exploitationLocation}
                                                onChange={(e) => setFormData(prev => ({ ...prev, exploitationLocation: e.target.value }))}
                                                className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                placeholder="Lieu de diffusion/exploitation"
                                            />
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2">
                                                <Hash />
                                                Code ISWC
                                            </label>
                                            <input
                                                type="text"
                                                value={formData.iswcCode}
                                                onChange={(e) => setFormData(prev => ({ ...prev, iswcCode: e.target.value }))}
                                                className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                                placeholder="T-000000000-0"
                                            />
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* Ayants droit */}
                            <div className="space-y-6">
                                <div className="bg-gradient-to-r from-blue-100 to-purple-100 p-6 rounded-xl">
                                    <h2 className="text-xl font-semibold text-gray-800 mb-4 flex items-center gap-2">
                                        <Users />
                                        Ayants droit
                                    </h2>

                                    {/* Recherche et ajout */}
                                    <div className="relative mb-6">
                                        <div className="relative">
                                            <div className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400">
                                                <Search />
                                            </div>
                                            <input
                                                type="text"
                                                value={searchTerm}
                                                onChange={(e) => handleSearch(e.target.value)}
                                                onFocus={() => searchTerm.length > 1 && setShowSuggestions(true)}
                                                className="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                placeholder="Rechercher un artiste ou éditeur..."
                                            />
                                        </div>
                                        
                                        {showSuggestions && suggestions.length > 0 && (
                                            <div className="absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-60 overflow-y-auto">
                                                {suggestions.map((item) => (
                                                    <div
                                                        key={item.id}
                                                        onClick={() => selectSuggestion(item)}
                                                        className="px-4 py-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-b-0"
                                                    >
                                                        <div className="font-medium text-gray-800">{item.name}</div>
                                                        {item.pseudonym && <div className="text-sm text-gray-600">({item.pseudonym})</div>}
                                                        <div className="text-xs text-gray-500 capitalize">{item.type}</div>
                                                    </div>
                                                ))}
                                            </div>
                                        )}
                                    </div>

                                    {/* Liste des ayants droit */}
                                    <div className="space-y-4">
                                        {formData.rightHolders.map((holder) => (
                                            <div key={holder.id} className="bg-white p-4 rounded-lg border border-gray-200">
                                                <div className="flex items-center justify-between mb-2">
                                                    <div className="flex-1">
                                                        <div className="font-medium text-gray-800">{holder.name}</div>
                                                        {holder.pseudonym && <div className="text-sm text-gray-600">({holder.pseudonym})</div>}
                                                        <div className="text-xs text-gray-500 capitalize">{holder.role}</div>
                                                    </div>
                                                    <button
                                                        onClick={() => removeRightHolder(holder.id)}
                                                        className="text-red-500 hover:text-red-700 p-2"
                                                    >
                                                        <Trash2 />
                                                    </button>
                                                </div>
                                                <div className="flex items-center gap-2">
                                                    <input
                                                        type="number"
                                                        value={holder.percentage}
                                                        onChange={(e) => updatePercentage(holder.id, e.target.value)}
                                                        className="w-20 px-2 py-1 border border-gray-300 rounded text-sm"
                                                        min="0"
                                                        max="100"
                                                        step="0.1"
                                                    />
                                                    <span className="text-sm text-gray-600">%</span>
                                                </div>
                                            </div>
                                        ))}
                                    </div>

                                    {/* Total des pourcentages */}
                                    <div className="mt-6 p-4 bg-white rounded-lg border border-gray-200">
                                        <div className="flex justify-between items-center">
                                            <span className="font-medium text-gray-700">Total des pourcentages:</span>
                                            <span className={`font-bold text-lg ${getTotalPercentage() === 100 ? 'text-green-600' : 'text-red-600'}`}>
                                                {getTotalPercentage()}%
                                            </span>
                                        </div>
                                        {getTotalPercentage() !== 100 && (
                                            <div className="text-sm text-red-600 mt-2">
                                                Le total doit être égal à 100%
                                            </div>
                                        )}
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Bouton de génération */}
                        <div className="mt-8 flex justify-center">
                            <button
                                onClick={generatePDF}
                                className="flex items-center gap-2 px-8 py-4 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-xl hover:from-purple-700 hover:to-pink-700 transition-all duration-200 font-semibold shadow-lg"
                            >
                                <Download />
                                Générer le bulletin SACEM
                            </button>
                        </div>

                        {/* Aperçu */}
                        {formData.title && (
                            <div className="mt-8 p-6 bg-gray-50 rounded-xl">
                                <h3 className="text-lg font-semibold text-gray-800 mb-4">Aperçu du bulletin</h3>
                                <div className="text-sm text-gray-600 space-y-2">
                                    <div><strong>Titre:</strong> {formData.title}</div>
                                    {formData.subtitle && <div><strong>Sous-titre:</strong> {formData.subtitle}</div>}
                                    <div><strong>Durée:</strong> {formData.duration.minutes}:{formData.duration.seconds.toString().padStart(2, '0')}</div>
                                    <div><strong>Genre:</strong> {formData.genre}</div>
                                    {formData
